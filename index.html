<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MUST Calculator — Amputation Adjusted</title>

<style>
:root {
  --accent:#0057ff;
  --accent-dark:#003bb8;
  --border:#d0d7ff;
  --card:#f2f5ff;
}

body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  margin:20px;
  max-width:760px;
  line-height:1.55;
}

h1 {
  color:var(--accent-dark);
  font-size:1.8rem;
}

.step-title {
  margin-top:28px;
  font-size:1.4rem;
  font-weight:700;
  color:var(--accent-dark);
}

label {
  display:block;
  margin-top:14px;
  font-weight:600;
}

input, select {
  width:100%;
  padding:14px;
  margin-top:6px;
  font-size:1rem;
  border:2px solid var(--border);
  border-radius:8px;
}

button {
  width:100%;
  margin-top:22px;
  padding:16px;
  font-size:1.2rem;
  font-weight:700;
  background:var(--accent);
  color:white;
  border:none;
  border-radius:8px;
}

button:active { background:var(--accent-dark); }

.collapsible {
  margin-top:10px;
  padding:12px;
  background:#eef1ff;
  border:1px solid var(--border);
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}

.collapsible-content {
  display:none;
  margin-top:8px;
  padding:12px;
  background:#f7f8ff;
  border-left:4px solid var(--accent);
  border-radius:6px;
}

.result {
  margin-top:24px;
  padding:18px;
  background:var(--card);
  border-radius:10px;
  border:1px solid var(--border);
}

.row {
  display:flex;
  gap:8px;
}

hr {
  margin:16px 0;
  border:0;
  border-top:2px solid var(--border);
}

.risk-low { color:green; font-weight:700; }
.risk-medium { color:#ff8c00; font-weight:700; }
.risk-high { color:red; font-weight:700; }

@media(max-width:500px){
  body { margin:14px; }
}
</style>
</head>

<body>

<h1>MUST – Amputation-Adjusted Calculator</h1>

<!-- STEP 1 -->
<div class="step-title">Step 1 — BMI</div>

<label>Height (m)
  <input id="heightM" type="number" step="0.01" placeholder="Enter measured height if available">
</label>

<div class="collapsible" id="ulnaToggle">
No accurate height available? Click here to estimate height using ulna length
</div>

<div class="collapsible-content" id="ulnaContent">
  <label>Patient sex
    <select id="sex">
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  </label>

  <label>Ulna length (cm)
    <input id="ulnaLength" type="number" step="0.1">
  </label>

  <small>
    Height will be automatically estimated using BAPEN MUST guidance.
  </small>

  <p style="margin-top:10px; font-size:0.95rem;">
    Need help measuring ulna length?
    <a href="https://www.bapen.org.uk/pdfs/must/must_page6.pdf"
       target="_blank" rel="noopener">
      View the BAPEN MUST ulna measurement guide (PDF)
    </a>
  </p>
</div>

<label>Weight (kg)
  <input id="obsWeight" type="number" step="0.1">
</label>

<label>Amputation level
<select id="ampLevel">
  <option value="0">No amputation</option>

  <optgroup label="Lower Limb (Unilateral)">
    <option value="0.16">Full lower limb (16%)</option>
    <option value="0.097">Above knee / thigh (9.7%)</option>
    <option value="0.059">Below knee + foot (5.9%)</option>
    <option value="0.014">Foot (1.4%)</option>
    <option value="0.007">Half foot (0.7%)</option>
  </optgroup>

  <optgroup label="Lower Limb (Bilateral)">
    <option value="0.32">Bilateral full lower limbs (32%)</option>
    <option value="0.194">Bilateral above knee / thighs (19.4%)</option>
    <option value="0.118">Bilateral below knee + foot (11.8%)</option>
    <option value="0.028">Bilateral feet (2.8%)</option>
    <option value="0.014">Bilateral half feet (1.4%)</option>
  </optgroup>

  <optgroup label="Upper Limb (Unilateral)">
    <option value="0.05">Full upper limb (5%)</option>
    <option value="0.023">Forearm (2.3%)</option>
    <option value="0.007">Hand (0.7%)</option>
  </optgroup>

  <optgroup label="Upper Limb (Bilateral)">
    <option value="0.10">Bilateral full upper limbs (10%)</option>
    <option value="0.046">Bilateral forearms (4.6%)</option>
    <option value="0.014">Bilateral hands (1.4%)</option>
  </optgroup>
</select>
</label>

<!-- STEP 2 -->
<div class="step-title">Step 2 — Weight Loss</div>

<label>Previous/usual weight (kg)
  <input id="prevWeight" type="number" step="0.1">
</label>

<div class="collapsible" id="infoToggle">
Where can previous weights be found?
</div>

<div class="collapsible-content" id="infoContent">
Previous nursing admission or re-assessment booklets, drug kardexes, medical notes, handover from nursing/care homes, or by asking the patient or family members for their best recollection.
</div>

<label>Time since previous/usual weight</label>
<div class="row">
  <input id="prevWeightMonths" type="number" placeholder="Months">
  <input id="prevWeightYears" type="number" placeholder="Years">
</div>

<!-- STEP 3 -->
<div class="step-title">Step 3 — Acute Disease Effect</div>

<label>Patient is acutely ill <strong>and</strong> there has been or is likely to be no nutritional intake for &gt;5 days
<select id="acute">
  <option value="0">No</option>
  <option value="2">Yes — score 2</option>
</select>
</label>

<button id="calc">Calculate MUST Score</button>

<div id="out" class="result" style="display:none"></div>

<script>
// Collapsibles
infoToggle.onclick = () =>
  infoContent.style.display = infoContent.style.display==="block"?"none":"block";
ulnaToggle.onclick = () =>
  ulnaContent.style.display = ulnaContent.style.display==="block"?"none":"block";

// Scoring
const bmiScore=b=>b<18.5?2:b<20?1:0;
const wlScore=p=>p>=10?2:p>=5?1:0;

// Calculate
calc.onclick = ()=>{
  const obs=+obsWeight.value, prev=+prevWeight.value;
  let height=+heightM.value;
  const ulna=+ulnaLength.value, sexVal=sex.value;
  const P=+ampLevel.value, acuteScore=+acute.value;

  if(ulna>0){
    height=(sexVal==="male"?(3.26*ulna+65.53):(4.02*ulna+47.53))/100;
  }
  if(!obs||!prev||!height){
    alert("Please complete required fields");
    return;
  }

  const adjW=obs/(1-P);
  const bmi=adjW/(height*height);
  const wl=Math.max(0,Math.round(((prev-adjW)/prev)*1000)/10);
  const total=bmiScore(bmi)+wlScore(wl)+acuteScore;

  let risk,action,steps=[];
  if(total===0){
    risk="low"; action="Routine Clinical Care";
    steps=["Repeat MUST screening weekly"];
  } else if(total===1){
    risk="medium"; action="Observe";
    steps=[
      "Document dietary intake for 3 days",
      "If adequate: repeat screening weekly",
      "If inadequate: follow local policy, set goals, monitor regularly"
    ];
  } else {
    risk="high"; action="Treat";
    steps=[
      "Refer to dietitian",
      "Improve and increase nutritional intake",
      "Monitor and review weekly"
    ];
  }

  out.style.display="block";
  out.innerHTML=`
    <strong>Results</strong><br><br>

    <div class="step-title">Step 1 — BMI</div>
    Weight adjusted for amputation: <strong>${adjW.toFixed(1)} kg</strong><br>
    BMI: <strong>${bmi.toFixed(1)} kg/m²</strong> (score ${bmiScore(bmi)})<br><br>

    <div class="step-title">Step 2 — Weight Loss</div>
    Weight loss: <strong>${wl}%</strong> (score ${wlScore(wl)})<br><br>

    <div class="step-title">Step 3 — Acute Disease Effect</div>
    Acute disease score: <strong>${acuteScore}</strong><br><br>

    <hr>
    <strong>Total MUST score:</strong> ${total}<br>
    <strong>Risk:</strong> <span class="risk-${risk}">${risk.toUpperCase()}</span><br><br>

    <strong>Recommended action:</strong><br>
    <strong>${action}</strong>
    <ul>${steps.map(s=>`<li>${s}</li>`).join("")}</ul>
  `;
  out.scrollIntoView({behavior:"smooth"});
};
</script>

</body>
</html>

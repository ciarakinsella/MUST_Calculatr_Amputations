<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MUST Calculator — Amputation-Adjusted</title>

<style>
:root {
  --bg: #ffffff;
  --text: #111111;
  --accent: #0057ff;
  --accent-dark: #003bb8;
  --card-bg: #f2f5ff;
  --border: #d0d7ff;

  --font-large: 1.15rem;
  --font-med: 1.05rem;
}

body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  margin: 22px;
  max-width: 760px;
  color: var(--text);
  background: var(--bg);
  font-size: var(--font-med);
  line-height: 1.55;
  padding-bottom: 40px;
}

h1 { font-size: 1.8rem; margin-bottom:10px; color:var(--accent-dark);}
.step-title { font-size:1.4rem; font-weight:700; margin-top:26px; margin-bottom:4px; color:var(--accent-dark);}
label { display:block; font-weight:600; margin-top:14px; font-size:var(--font-large);}
input, select { padding:14px; margin-top:6px; width:100%; box-sizing:border-box; font-size:var(--font-med); border:2px solid var(--border); border-radius:8px;}
button { margin-top:18px; padding:16px; font-size:1.2rem; font-weight:600; width:100%; background:var(--accent); color:white; border:none; border-radius:8px; cursor:pointer;}
button:active{background:var(--accent-dark);}
.result{background:var(--card-bg); padding:18px; margin-top:20px; border-radius:10px; border:1px solid var(--border); font-size:var(--font-large);}
.collapsible{margin-top:8px; padding:12px; background:#eef1ff; border:1px solid var(--border); border-radius:8px; cursor:pointer; font-weight:600;}
.collapsible-content{display:none; padding:12px; margin-top:6px; background:#f7f8ff; border-left:3px solid var(--accent); border-radius:6px; font-size:0.95rem;}
hr{margin:16px 0; border:0; border-top:2px solid var(--border);}
.cite{margin-top:20px; font-size:0.85rem; color:#444;}
.row{display:flex; gap:6px;}

/* Risk color classes */
.risk-low { color: #008000; font-weight: 700; }
.risk-medium { color: #ff8c00; font-weight: 700; }
.risk-high { color: #ff0000; font-weight: 700; }

@media (max-width:500px){body{margin:16px;} h1{font-size:1.6rem;} .step-title{font-size:1.3rem;} button{font-size:1.1rem;} label{font-size:1.1rem;}}
</style>
</head>

<body>

<h1>MUST — Amputation-Adjusted Calculator</h1>

<!-- STEP 1 -->
<div class="step-title">Step 1 — BMI</div>
<label>Observed weight (kg)<input id="obsWeight" type="number" step="0.1" min="0"></label>
<label>Height (m)<input id="heightM" type="number" step="0.01" min="0"></label>

<label>Amputation level
<select id="ampLevel">
<option value="0">No amputation</option>

<!-- LOWER LIMB UNILATERAL -->
<optgroup label="Lower Limb (Unilateral)">
  <option value="0.16">Full lower limb (16%)</option>
  <option value="0.097">Above knee / thigh (9.7%)</option>
  <option value="0.059">Below knee + foot (5.9%)</option>
  <option value="0.014">Foot (1.4%)</option>
  <option value="0.007">Half foot (0.7%)</option>
</optgroup>

<!-- LOWER LIMB BILATERAL -->
<optgroup label="Lower Limb (Bilateral)">
  <option value="0.32">Bilateral full lower limbs (32%)</option>
  <option value="0.194">Bilateral above knee / thighs (19.4%)</option>
  <option value="0.118">Bilateral below knee + foot (11.8%)</option>
  <option value="0.028">Bilateral feet (2.8%)</option>
  <option value="0.014">Bilateral half feet (1.4%)</option>
</optgroup>

<!-- UPPER LIMB UNILATERAL -->
<optgroup label="Upper Limb (Unilateral)">
  <option value="0.05">Full upper limb (5%)</option>
  <option value="0.023">Forearm (2.3%)</option>
  <option value="0.007">Hand (0.7%)</option>
</optgroup>

<!-- UPPER LIMB BILATERAL -->
<optgroup label="Upper Limb (Bilateral)">
  <option value="0.10">Bilateral full upper limbs (10%)</option>
  <option value="0.046">Bilateral forearms (4.6%)</option>
  <option value="0.014">Bilateral hands (1.4%)</option>
</optgroup>

</select>
</label>

<!-- STEP 2 -->
<div class="step-title">Step 2 — Weight Loss</div>
<label>Previous weight (kg)<input id="prevWeight" type="number" step="0.1" min="0"></label>

<div class="collapsible" id="infoToggle">Where can previous weights be found?</div>
<div class="collapsible-content" id="infoContent">
Previous nursing admission or re-assessment booklets, drug kardexes, medical notes, handover from nursing/care homes, or by asking the patient or family members for their best recollection.
</div>

<label>Time since previous weight</label>
<div class="row">
  <input id="prevWeightMonths" type="number" step="1" min="0" placeholder="Months" style="flex:1;">
  <input id="prevWeightYears" type="number" step="1" min="0" placeholder="Years" style="flex:1;">
</div>

<!-- STEP 3 -->
<div class="step-title">Step 3 — Acute Disease Effect</div>
<label>Acute disease effect (no nutrition >5 days?)
<select id="acute">
  <option value="0">No</option>
  <option value="2">Yes — score 2</option>
</select>
</label>

<button id="calc">Calculate MUST Score</button>

<div id="out" class="result" style="display:none"></div>

<div class="cite">
This calculator is a clinical aid. Always follow local policy and clinical judgement.
</div>

<script>
// Collapsible info card
document.getElementById("infoToggle").addEventListener("click", function() {
  const box = document.getElementById("infoContent");
  box.style.display = box.style.display === "block" ? "none" : "block";
});

// Calculator Logic
function round1(n){ return Math.round(n*10)/10; }
function mustScoreBMI(bmi){
  if (bmi < 18.5) return 2;
  if (bmi >= 18.5 && bmi < 20) return 1;
  return 0;
}
function mustScoreWL(percent){
  if (percent >= 10) return 2;
  if (percent >= 5) return 1;
  return 0;
}

document.getElementById('calc').addEventListener('click',()=>{
  const obs = parseFloat(document.getElementById('obsWeight').value);
  const hM = parseFloat(document.getElementById('heightM').value);
  const prev = parseFloat(document.getElementById('prevWeight').value);
  const prevMonths = parseInt(document.getElementById('prevWeightMonths').value) || 0;
  const prevYears = parseInt(document.getElementById('prevWeightYears').value) || 0;
  const totalMonths = prevYears*12 + prevMonths;
  const P = parseFloat(document.getElementById('ampLevel').value);
  const acute = parseFloat(document.getElementById('acute').value);

  if (isNaN(obs) || obs<=0 || isNaN(hM) || hM<=0){
    alert('Please enter valid observed weight and height.');
    return;
  }

  if (isNaN(prev) || prev<=0){
    alert('Please enter a valid previous weight.');
    return;
  }

  const estWeight = obs / (1 - P);
  const bmi = estWeight / (hM * hM);

  let wlPercent = Math.round(((prev - estWeight)/prev)*1000)/10; 
  if (wlPercent < 0) wlPercent = 0;

  let weightAgeWarning = "";
  if(totalMonths < 3 || totalMonths > 6){
    weightAgeWarning = " ⚠️ Previous weight not within 3–6 months (MUST guideline). Use clinical judgment.";
  }

  const bmiScore = mustScoreBMI(bmi);
  const wlScore = mustScoreWL(wlPercent);
  const totalScore = bmiScore + wlScore + acute;

  // Color-coded risk & action
  let riskText = "";
  let actionHeader = "";
  let actionSteps = [];
  if(totalScore === 0) {
    riskText = '<span class="risk-low">Low risk</span>';
    actionHeader = 'Routine Clinical Care';
    actionSteps = ['Repeat MUST screening weekly'];
  }
  else if(totalScore === 1) {
    riskText = '<span class="risk-medium">Medium risk</span>';
    actionHeader = 'Observe';
    actionSteps = [
      'Document dietary intake for 3 days',
      'If adequate: little concern, repeat screening weekly',
      'If inadequate: clinical concern — follow local policies, set goals, improve and increase nutritional intake, monitor and review care plan regularly'
    ];
  }
  else {
    riskText = '<span class="risk-high">High risk</span>';
    actionHeader = 'Treat';
    actionSteps = [
      'Refer to dietitian',
      'Set goals, improve and increase nutritional intake',
      'Monitor and review care plan weekly'
    ];
  }

  // Convert steps array to HTML bullets
  const actionStepsHTML = '<ul><li>' + actionSteps.join('</li><li>') + '</li></ul>';

  // Display results
  const outBox = document.getElementById('out');
  outBox.style.display = 'block';
  outBox.innerHTML = `
    <strong>Results</strong><br><br>

    <div class="step-title">Step 1 — BMI</div>
    Observed weight adjusted for amputation: <strong>${Math.round(estWeight*10)/10} kg</strong><br>
    BMI: <strong>${Math.round(bmi*10)/10}</strong> (score ${bmiScore})<br><br>

    <div class="step-title">Step 2 — Weight Loss</div>
    Previous weight: <strong>${prev} kg</strong><br>
    Weight loss %: <strong>${wlPercent}%</strong>${weightAgeWarning}<br>
    Weight-loss score: <strong>${wlScore}</strong><br><br>

    <div class="step-title">Step 3 — Acute Disease Effect</div>
    Acute disease score: <strong>${acute}</strong><br><br>

    <hr>
    <strong>Total MUST score:</strong> ${totalScore}<br>
    <strong>Risk category:</strong> ${riskText}<br><br>

    <strong>Recommended action:</strong><br>
    <strong>${actionHeader}</strong>
    ${actionStepsHTML}
  `;

  // Scroll results into view
  outBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
});
</script>

</body>
</html>
